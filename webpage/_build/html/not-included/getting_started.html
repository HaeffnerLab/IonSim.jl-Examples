

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>How it works</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-dropdown.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/customize.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../_static/small-logo.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Introduction
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Examples
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../example-notebooks/ramped_molmer_sorensen.html">
   Ramped Molmer-Sorensen
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/not-included/getting_started.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/HaeffnerLab/IonSim.jl-Examples"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/HaeffnerLab/IonSim.jl-Examples/issues/new?title=Issue%20on%20page%20%2Fnot-included/getting_started.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/HaeffnerLab/IonSim.jl-Examples/edit/master/not-included/getting_started.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/HaeffnerLab/IonSim.jl-Examples/master?urlpath=tree/not-included/getting_started.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#load-necessary-modules">
   Load necessary modules
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-up-the-system">
   Setting up the system
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simulating-basic-dynamics">
   Simulating basic dynamics
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#carrier-rabi">
     Carrier Rabi
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sideband-transitions">
     Sideband Transitions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#time-dependent-parameters">
     Time-dependent parameters
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#noise">
     Noise
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adding-more-than-a-single-ion-laser">
     Adding more than a single ion/ laser
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ionsim-physicalconstants">
     IonSim.PhysicalConstants
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <p>What IonSim does</p>
<p>IonSim is built around <a class="reference external" href="https://qojulia.org/">QuantumOptics.jl</a> and is primarily intended to simulate the following general system:</p>
<hr class="docutils" />
<img src="trapped_ion_system.png" align="center"/><hr class="docutils" />
<p>Whose corresponding Hamiltonian (in an appropriate rotating frame) is given by:</p>
<p><img alt="" src="not-included/hamiltonian_equation.png" /></p>
<p>Here:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\Omega_{nm} \cdot g(m, k_n, j_n)\)</span> describes the coupling between the <span class="math notranslate nohighlight">\(m^{th}\)</span> laser and the <span class="math notranslate nohighlight">\(n^{th}\)</span> ion’s <span class="math notranslate nohighlight">\(|k_n\rangle \leftrightarrow | j_n \rangle\)</span> transition – <span class="math notranslate nohighlight">\(\Omega_{nm}\)</span> depends on the intensity of the laser at the ion’s position and <span class="math notranslate nohighlight">\(g\)</span> is a geometric factor that depends on the details of the laser and transition.</p></li>
<li><p><span class="math notranslate nohighlight">\(\bar{\Delta}_{nmk_nj_n}\)</span> is the average detuning of the m<span class="math notranslate nohighlight">\(^{th}\)</span> laser from <span class="math notranslate nohighlight">\(|k_n\rangle \leftrightarrow | j_n \rangle\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(\hat{\sigma}_{n,k_n,j_n} = |k_n\rangle\langle j_n|\)</span></p></li>
</ul>
<hr class="docutils" />
<p>To enable the simulation, IonSim performs two main tasks:</p>
<ol class="simple">
<li><p>Keeps track of the parameters and structure of the Hamiltonian according to user inputs</p></li>
<li><p>Given these inputs, constructs a function that efficiently returns the numerical representation of the Hamiltonian as a function of time.</p></li>
</ol>
<p>The Hamiltonian function can then be used as input to one of the various <strong>QuantumOptics.jl</strong> differential equation solvers.</p>
<hr class="docutils" />
<p><strong>1)</strong> is accomplished with the use of Julia <a class="reference external" href="https://docs.julialang.org/en/v1/manual/types/"><code class="docutils literal notranslate"><span class="pre">structs</span></code></a>.</p>
<p>For reference, a map of these <code class="docutils literal notranslate"><span class="pre">structs</span></code> and their relationships is shown below.</p>
<p><img alt="" src="not-included/graph.png" /></p>
<!-- <img src="graph.png"  width=1000 height=1000 align="center"/> --><hr class="docutils" />
<p><strong>2)</strong> is mainly handled in <span class="xref myst">hamiltonians.jl</span>.</p>
<hr class="docutils" />
<div class="section" id="how-it-works">
<h1>How it works<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h1>
<p>We’ll demonstrate the basics by walking you through some simple examples.</p>
<div class="section" id="load-necessary-modules">
<h2>Load necessary modules<a class="headerlink" href="#load-necessary-modules" title="Permalink to this headline">¶</a></h2>
<hr class="docutils" />
<p>When starting a new notebook, the first thing we have to do is load in the relevant modules.</p>
<p><em>Note: loading modules can be slow in Julia. The same is true when running a function for the first time. This has to do with precompilation, see <a class="reference external" href="https://stackoverflow.com/questions/47501844/julia-differentialequations-jl-speed">here</a> or <a class="reference external" href="https://discourse.julialang.org/t/ways-to-make-slow-sluggish-repl-interactive-development-experience-faster/25293">here</a> for more details. One workaround is to just keep notebooks running as long as possible, but you can also look into creating a sysimage with <a class="reference external" href="https://github.com/JuliaLang/PackageCompiler.jla">PackageCompiler.jl</a>.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">Revise</span>
<span class="k">using</span> <span class="n">IonSim</span>
<span class="k">using</span> <span class="n">QuantumOptics</span><span class="o">:</span> <span class="n">timeevolution</span><span class="p">,</span> <span class="n">stochastic</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p>We’ll also load PyPlot (an interface to Python’s matplotlib), which we’ll need later</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="n">PyPlot</span>
<span class="kd">const</span> <span class="n">plt</span> <span class="o">=</span> <span class="n">PyPlot</span>
<span class="c"># set some plot configs</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s">&quot;xtick&quot;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">false</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s">&quot;ytick&quot;</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">false</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">false</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s">&quot;axes&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">titlesize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">true</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s">&quot;axes&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s">&quot;grid&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&quot;--&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s">&quot;font&quot;</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s">&quot;Palatino&quot;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s">&quot;medium&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s">&quot;figure&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s">&quot;xtick.major&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s">&quot;ytick.major&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="setting-up-the-system">
<h2>Setting up the system<a class="headerlink" href="#setting-up-the-system" title="Permalink to this headline">¶</a></h2>
<p>First we’ll create an ion:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="o">=</span> <span class="n">Ca40</span><span class="p">([</span><span class="s">&quot;S-1/2&quot;</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">])</span>
<span class="n">print</span><span class="p">(</span><span class="n">typeof</span><span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="o">&lt;:</span> <span class="n">Ion</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>true
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p><code class="docutils literal notranslate"><span class="pre">Ca40</span></code> is a composite type derived from the abstract type <code class="docutils literal notranslate"><span class="pre">Ion</span></code> (as demonstrated in the second line). By giving the argument <code class="docutils literal notranslate"><span class="pre">[&quot;S-1/2&quot;,</span> <span class="pre">&quot;D-1/2&quot;]</span></code> we’ve decided to only pay attention to these two electronic levels.</p>
<p>To see all of the options for <code class="docutils literal notranslate"><span class="pre">Ca40</span></code> we can look at its doc string, which can be accessed in Julia by typing <code class="docutils literal notranslate"><span class="pre">?</span></code> before the variable name:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="o">?</span><span class="n">Ca40</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>search: <span class=" -Color -Color-Bold">Ca40</span>
</pre></div>
</div>
<div class="highlight- notranslate"><div class="highlight"><pre><span></span>Ca40(selected_level_structure::Vector{String}[, stark_shift])
</pre></div>
</div>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<span class="docutils literal">notset</span>, line 5)</p>
<p>Non-consecutive header level increase; 0 to 4</p>
</div>
</div>
</div>
<hr class="docutils" />
<p>We can also preview the values of the various fields of our instantiated <code class="docutils literal notranslate"><span class="pre">C</span></code> by typing <code class="docutils literal notranslate"><span class="pre">C.</span></code> and pressing the tab key.</p>
<hr class="docutils" />
<p>Next we’ll define a laser:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="n">Laser</span><span class="p">();</span>
<span class="n">print</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>λ: 7.29147e-7 m
Δ: 0 Hz
ϵ̂: (x=0.7071067811865475, y=0.7071067811865475, z=0.0)
k̂: (z=0, y=0, z=1)
E(t=0): 0 V/m
ϕ(t=0): 0 ⋅ 2π
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p>As shown, the default wavelength of <code class="docutils literal notranslate"><span class="pre">Laser</span></code> is set to match spin-orbit splitting of the <span class="math notranslate nohighlight">\(S_{1/2}\)</span> and <span class="math notranslate nohighlight">\(D_{5/2}\)</span> levels of <span class="math notranslate nohighlight">\(^{40}\)</span>Ca. Again, to view the other attributes for <code class="docutils literal notranslate"><span class="pre">Laser</span></code> take a look at its doc string (or use <code class="docutils literal notranslate"><span class="pre">L.</span></code> + tabkey).</p>
<p>To include the center of mass motion of the ion in our simulation, we need to add it to an <code class="docutils literal notranslate"><span class="pre">IonConfiguration</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">chain</span> <span class="o">=</span> <span class="n">LinearChain</span><span class="p">(</span><span class="n">ions</span><span class="o">=</span><span class="p">[</span><span class="n">C</span><span class="p">],</span> <span class="n">com_frequencies</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">3e6</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mf">3e6</span><span class="p">,</span><span class="n">z</span><span class="o">=</span><span class="mf">1e6</span><span class="p">),</span> <span class="n">vibrational_modes</span><span class="o">=</span><span class="p">(;</span><span class="n">z</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">print</span><span class="p">(</span><span class="n">typeof</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span> <span class="o">&lt;:</span> <span class="n">IonConfiguration</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>true
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p><code class="docutils literal notranslate"><span class="pre">LinearChain</span></code> automatically computes the normal modes for a collection of ions (as input to keyword argument <code class="docutils literal notranslate"><span class="pre">ions</span></code>) in a linear Coloumb crystal with the given center of mass frequencies. By setting <code class="docutils literal notranslate"><span class="pre">vibrational_modes=(;z=[1])</span></code> (which is the same as <code class="docutils literal notranslate"><span class="pre">vibrational_modes=(x=[],</span> <span class="pre">y=[],</span> <span class="pre">z=[1])</span></code> or <code class="docutils literal notranslate"><span class="pre">vibrational_modes=(y=[],</span> <span class="pre">z=[1])</span></code>) we’ve decided to only consider the 1st normal mode along the ẑ-direction. <em>(Note: ẑ is always assumed to be along the crystal’s axis of symmetry).</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">chain</span><span class="o">.</span><span class="n">vibrational_modes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(x = VibrationalMode[], y = VibrationalMode[], z = VibrationalMode[VibrationalMode(ν=1.0e6, axis=ẑ, N=10)])
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p>The last thing we need to construct is a <code class="docutils literal notranslate"><span class="pre">Trap</span></code>, which takes all of these objects that we’ve defined and puts them together:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="n">Trap</span><span class="p">(</span><span class="n">configuration</span><span class="o">=</span><span class="n">chain</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mf">4e-4</span><span class="p">,</span> <span class="n">Bhat</span><span class="o">=</span><span class="n">ẑ</span><span class="p">,</span> <span class="n">δB</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lasers</span><span class="o">=</span><span class="p">[</span><span class="n">L</span><span class="p">]);</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p>A <code class="docutils literal notranslate"><span class="pre">Trap</span></code> specifically associates an <code class="docutils literal notranslate"><span class="pre">IonConifiguration</span></code> and a set of lasers. It keeps track of which lasers point at which ions and with how much scaled strength (to model e.g. crosstalk). It also keeps track of the magnetic field. In this case we’ve set the magnetic field to have a strength of 4 Gauss and to point in the ẑ-direction. δB can be used to model a time-dependent magnetic field, which for example, might be useful to model noise – for now we set it to 0.</p>
<p>An important point needs to be made on the ordering of the composite basis, which describes the trap’s Hilbert space. Though, mathematically, <code class="docutils literal notranslate"><span class="pre">C.basis</span> <span class="pre">⊗</span> <span class="pre">configuration.vibrational_modes.z[1].basis</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">configuration.vibrational_modes.z[1].basis</span> <span class="pre">⊗</span> <span class="pre">C.basis</span></code>, when converted to the space of 2D matrices the description of these two bases will be different. Equivalence is maintained provided that the order is consistent throughout the description of the problem, but this requires us to set a convention. For a trap composed of a linear chain of ions, IonSim’s convention is: ion₁ ⊗ ion₂ ⊗ … ⊗ ionₙ ⊗ mode₁ ⊗ mode₂ ⊗ … ⊗ modeₙ, where the ion bases are ordered according to the order in <code class="docutils literal notranslate"><span class="pre">T.configuration.ions</span></code> and the vibrational modes are ordered according to the order in <code class="docutils literal notranslate"><span class="pre">[T.configuration.vibrational_modes.x,</span> <span class="pre">T.configuration.vibrational_modes.y,</span> <span class="pre">T.configuration.vibrational_modes.z</span></code>].</p>
</div>
<div class="section" id="simulating-basic-dynamics">
<h2>Simulating basic dynamics<a class="headerlink" href="#simulating-basic-dynamics" title="Permalink to this headline">¶</a></h2>
<div class="section" id="carrier-rabi">
<h3>Carrier Rabi<a class="headerlink" href="#carrier-rabi" title="Permalink to this headline">¶</a></h3>
<p>Let’s start off by simulating rabi oscillations between the two defined states of our ion. First we have to update some of the parameters in our system.</p>
<p>Due to selection rules and because we’ve defined our magnetic field to point in the ẑ-direction we need to update the geometry of our laser to have a nonzero coupling to this transition:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">x̂</span> <span class="o">+</span> <span class="n">ẑ</span><span class="p">)</span><span class="o">/√</span><span class="mi">2</span> 
<span class="n">L</span><span class="o">.</span><span class="n">ϵ</span> <span class="o">=</span> <span class="p">(</span><span class="n">x̂</span> <span class="o">-</span> <span class="n">ẑ</span><span class="p">)</span><span class="o">/√</span><span class="mi">2</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<hr class="docutils" />
<p>Since the nonzero magnitude of the Bfield has shifted the Zeeman sublevels we also need to detune the laser. We can do this with the help of the convenience function <code class="docutils literal notranslate"><span class="pre">transition_frequency</span></code>.</p>
<p><em>As a side note, we can see a full list of the functions available from IonSim by typing <code class="docutils literal notranslate"><span class="pre">IonSim.</span></code> and pressing the tab key. Functions beginning with an underscore are generally not meant to be accessed interactively. Everything else should have a doc string.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Δf</span> <span class="o">=</span> <span class="n">transition_frequency</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;S-1/2&quot;</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">))</span>
<span class="n">L</span><span class="o">.</span><span class="n">Δ</span> <span class="o">=</span> <span class="n">Δf</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.239399193848153e6
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="o">?</span><span class="n">transition_frequency</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>search: <span class=" -Color -Color-Bold">transition_frequency</span>
</pre></div>
</div>
<div class="highlight- notranslate"><div class="highlight"><pre><span></span>transition_frequency(
    B::Real, ion::Ion, transition::Union{Tuple{String,String},Vector{&lt;:String}}
)
</pre></div>
</div>
<p>Compute the transition frequency of the <code class="docutils literal notranslate"><span class="pre">ion</span></code>'s selected transition under Bfield <code class="docutils literal notranslate"><span class="pre">B</span></code>. Alternatively, one may use:</p>
<div class="highlight- notranslate"><div class="highlight"><pre><span></span>transition_frequency(
        T::Trap, ion::Ion, transition::Union{Tuple{String,String},Vector{&lt;:String}}
    )
</pre></div>
</div>
<p>which is the same as <code class="docutils literal notranslate"><span class="pre">transition_frequency(T.B,</span> <span class="pre">ion,</span> <span class="pre">transition)</span></code> or</p>
<div class="highlight- notranslate"><div class="highlight"><pre><span></span>transition_frequency(
        T::Trap, ion_index::Int, transition::Union{Tuple{String,String},Vector{&lt;:String}}
    )
</pre></div>
</div>
<p>which is the same as <code class="docutils literal notranslate"><span class="pre">transition_frequency(T.B,</span> <span class="pre">T.configuration.ions[ion_index],</span> <span class="pre">transition)</span></code>.</p>
</div>
</div>
<hr class="docutils" />
<p>Finally, we should set the laser’s electric field amplitude (at the position of the ion) to something reasonable. For this we use the convenience function <code class="docutils literal notranslate"><span class="pre">Efield_from_pi_time!</span></code> <em>(It’s customary in Julia to end the names of functions that update their arguments in-place with a “!”).</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Efield_from_pi_time!</span><span class="p">(</span><span class="mf">2e-6</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;S-1/2&quot;</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">));</span>  <span class="c"># Sets pi_time to 2 μs</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="o">?</span><span class="n">Efield_from_pi_time</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>search: <span class=" -Color -Color-Bold">Efield_from_pi_time</span> <span class=" -Color -Color-Bold">Efield_from_pi_time</span>!
</pre></div>
</div>
<div class="highlight- notranslate"><div class="highlight"><pre><span></span>Efield_from_pi_time(
    pi_time::Real, Bhat::NamedTuple{(:x,:y,:z)}, laser::Laser, ion::Ion, 
    transition::Union{Tuple{String,String},Vector{&lt;:String}}
)
</pre></div>
</div>
<p>Compute the E-field needed to get a certain <code class="docutils literal notranslate"><span class="pre">pi_time</span></code> with a certain <code class="docutils literal notranslate"><span class="pre">laser</span></code>-<code class="docutils literal notranslate"><span class="pre">ion</span></code>  <code class="docutils literal notranslate"><span class="pre">transition</span></code>.</p>
<p>Alternatively, one may use</p>
<div class="highlight- notranslate"><div class="highlight"><pre><span></span>Efield_from_pi_time(
            pi_time::Real, T::Trap, laser_index::Int, ion_index::Int, 
            transition::Union{Tuple{String,String},Vector{&lt;:String}}
        )
</pre></div>
</div>
<p>which is the same as  <code class="docutils literal notranslate"><span class="pre">Efield_from_pi_time(pi_time,</span> <span class="pre">T.Bhat,</span> <span class="pre">T.lasers[laser_index],</span> <span class="pre">T.configuration.ions[ion_index],</span> <span class="pre">transition)</span></code></p>
</div>
</div>
<hr class="docutils" />
<p>The last thing we need to do before we run our simulation is to construct the hamiltonian:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="o">?</span><span class="n">hamiltonian</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>search: <span class=" -Color -Color-Bold">hamiltonian</span>
</pre></div>
</div>
<div class="highlight- notranslate"><div class="highlight"><pre><span></span>hamiltonian(
        T::Trap; timescale::Real=1e-6, lamb_dicke_order::Union{Vector{Int},Int}=1, 
        rwa_cutoff::Real=Inf, displacement=&quot;truncated&quot;, time_dependent_eta=false
    )
</pre></div>
</div>
<p>Constructs the Hamiltonian for <code class="docutils literal notranslate"><span class="pre">T</span></code> as a function of time. Return type is a function  <code class="docutils literal notranslate"><span class="pre">h(t::Real,</span> <span class="pre">ψ)</span></code> that, itself, returns a <code class="docutils literal notranslate"><span class="pre">QuantumOptics.SparseOperator</span></code>.</p>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<span class="docutils literal">notset</span>, line 10)</p>
<p>Non-consecutive header level increase; 0 to 4</p>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">h</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">timescale</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">);</span>  <span class="c"># setting timescale=1e-6 sets the units of time to μs</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can take <code class="docutils literal notranslate"><span class="pre">h</span></code> and feed it into one of the <a class="reference external" href="https://qojulia.org/documentation/timeevolution/timeevolution/"><code class="docutils literal notranslate"><span class="pre">QuantumOptics.timeevolution</span></code></a> solvers:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">tspan</span> <span class="o">=</span> <span class="mi">0</span><span class="o">:</span><span class="mf">0.01</span><span class="o">:</span><span class="mi">10</span>
<span class="n">mode</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">vibrational_modes</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="nd">@time</span> <span class="n">tout</span><span class="p">,</span> <span class="n">sol</span> <span class="o">=</span> <span class="n">timeevolution</span><span class="o">.</span><span class="n">schroedinger_dynamic</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">ionstate</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;S-1/2&quot;</span><span class="p">)</span> <span class="n">⊗</span> <span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">h</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 10.864052 seconds (36.17 M allocations: 1.901 GiB, 7.13% gc time)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">ex</span> <span class="o">=</span> <span class="n">expect</span><span class="p">(</span><span class="n">ionprojector</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">),</span> <span class="n">sol</span><span class="p">)</span>
<span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tout</span><span class="p">[</span><span class="k">end</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Excitation&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;Time [μs]&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/getting_started_50_0.png" src="../_images/getting_started_50_0.png" />
</div>
</div>
<p>In the above plot, we see Rabi oscillations with a pi-time of 2 μs, as expected.</p>
<p>Now if we add an additional detuning to the laser equal to the Rabi frequency, we should see oscillation with half the amplitude and √2 times the frequency:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="o">.</span><span class="n">Δ</span> <span class="o">=</span> <span class="n">Δf</span> <span class="o">+</span> <span class="mf">2.5e5</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">timescale</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
<span class="nd">@time</span> <span class="n">tout</span><span class="p">,</span> <span class="n">sol</span> <span class="o">=</span> <span class="n">timeevolution</span><span class="o">.</span><span class="n">schroedinger_dynamic</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">ionstate</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;S-1/2&quot;</span><span class="p">)</span> <span class="n">⊗</span> <span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">h</span><span class="p">)</span>

<span class="n">ex</span> <span class="o">=</span> <span class="n">expect</span><span class="p">(</span><span class="n">ionprojector</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">),</span> <span class="n">sol</span><span class="p">)</span>
<span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tout</span><span class="p">[</span><span class="k">end</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Excitation&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;Time [μs]&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/getting_started_52_0.png" src="../_images/getting_started_52_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.003041 seconds (92.43 k allocations: 3.284 MiB)
</pre></div>
</div>
</div>
</div>
<p>We can achieve the same effect by instead setting a nonzero value in our ion’s <code class="docutils literal notranslate"><span class="pre">stark_shift</span></code> field. This can be useful when we have several ions in our chain and want to simulate a Stark shift without involving an additional laser resource.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="o">.</span><span class="n">Δ</span> <span class="o">=</span> <span class="n">Δf</span>

<span class="n">C</span><span class="o">.</span><span class="n">stark_shift</span><span class="p">[</span><span class="s">&quot;S-1/2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.25e5</span>
<span class="n">C</span><span class="o">.</span><span class="n">stark_shift</span><span class="p">[</span><span class="s">&quot;D-1/2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.25e5</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">timescale</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
<span class="nd">@time</span> <span class="n">tout</span><span class="p">,</span> <span class="n">sol</span> <span class="o">=</span> <span class="n">timeevolution</span><span class="o">.</span><span class="n">schroedinger_dynamic</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">ionstate</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;S-1/2&quot;</span><span class="p">)</span> <span class="n">⊗</span> <span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">h</span><span class="p">)</span>

<span class="n">ex</span> <span class="o">=</span> <span class="n">expect</span><span class="p">(</span><span class="n">ionprojector</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">),</span> <span class="n">sol</span><span class="p">)</span>
<span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tout</span><span class="p">[</span><span class="k">end</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Excitation&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;Time [μs]&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/getting_started_54_0.png" src="../_images/getting_started_54_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.004155 seconds (92.43 k allocations: 3.284 MiB)
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p>So far our simulations have used an initial state <code class="docutils literal notranslate"><span class="pre">ion_state(T,</span> <span class="pre">&quot;S-1/2&quot;)</span> <span class="pre">⊗</span> <span class="pre">fockstate(mode.basis,</span> <span class="pre">0)</span></code>, or <span class="math notranslate nohighlight">\(|S_{-1/2}, n=0\rangle\)</span>, but we can also start off with the vibrational mode in a thermal state:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">zero_stark_shift</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>  <span class="c"># sets all artificial Stark shifts to zero</span>

<span class="c"># ions indexed by the string representing a particular level, return the associated ket</span>
<span class="c"># also, an apostrophe after a ket will return the associated bra</span>
<span class="n">ψi_ion</span> <span class="o">=</span> <span class="n">dm</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="s">&quot;S-1/2&quot;</span><span class="p">])</span>

<span class="c"># we&#39;d like to look at a pretty hot ion, so we need to increase our mode dimension, which is set to N=10 by default</span>
<span class="c"># here we set it to 100</span>
<span class="n">mode</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>

<span class="n">ψi_mode</span> <span class="o">=</span> <span class="n">thermalstate</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="n">ψi</span> <span class="o">=</span> <span class="n">ψi_ion</span> <span class="n">⊗</span> <span class="n">ψi_mode</span>

<span class="n">tspan</span> <span class="o">=</span> <span class="mi">0</span><span class="o">:</span><span class="mf">0.1</span><span class="o">:</span><span class="mi">50</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">timescale</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">rwa_cutoff</span><span class="o">=</span><span class="nb">Inf</span><span class="p">,</span> <span class="n">time_dependent_eta</span><span class="o">=</span><span class="kc">false</span><span class="p">,</span> <span class="n">displacement</span><span class="o">=</span><span class="s">&quot;truncated&quot;</span><span class="p">)</span>
<span class="nd">@time</span> <span class="n">tout</span><span class="p">,</span> <span class="n">sol</span> <span class="o">=</span> <span class="n">timeevolution</span><span class="o">.</span><span class="n">schroedinger_dynamic</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">ψi</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

<span class="n">ex</span> <span class="o">=</span> <span class="n">expect</span><span class="p">(</span><span class="n">ionprojector</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">),</span> <span class="n">sol</span><span class="p">)</span>
<span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tout</span><span class="p">[</span><span class="k">end</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Excitation&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;Time [μs]&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/getting_started_56_0.png" src="../_images/getting_started_56_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  7.272201 seconds (23.32 M allocations: 1.351 GiB, 5.69% gc time)
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p>We can compare this result with the analytical expression which can be found in IonSim’s <code class="docutils literal notranslate"><span class="pre">analytical</span></code> module:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="o">?</span><span class="n">analytical</span><span class="o">.</span><span class="n">rabi_flop</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="highlight- notranslate"><div class="highlight"><pre><span></span>rabi_flop(tspan, Ω::Real, η::Real, n̄::Real; s::Int=0) &lt;br&gt;
</pre></div>
</div>
<p>Single ion rabi flop. Returns: $\sum_{n=0}^∞ p_n sin^2(\Omega_n t)$ <br> with $\Omega_n = Ωe^{-η^2/2}η^s\sqrt{\frac{n!}{(n+s)!}}L_{n}^{s}(η^2)$ <br> where $s$ is the order of the (blue) sideband that we are driving and $L_{n}^{s}$ is the associated Laguerre polynomial. <a class="reference external" href="https://doi.org/10.1103/RevModPhys.75.281">ref</a></p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">ex</span> <span class="o">=</span> <span class="n">expect</span><span class="p">(</span><span class="n">ionprojector</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">),</span> <span class="n">sol</span><span class="p">)</span>
<span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;numerical&quot;</span><span class="p">)</span>

<span class="n">η</span> <span class="o">=</span> <span class="n">get_η</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tout</span><span class="p">,</span> <span class="n">analytical</span><span class="o">.</span><span class="n">rabi_flop</span><span class="p">(</span><span class="n">tout</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">η</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;analytical&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tout</span><span class="p">[</span><span class="k">end</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Excitation&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;Time [μs]&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/getting_started_59_0.png" src="../_images/getting_started_59_0.png" />
</div>
</div>
<hr class="docutils" />
<p>We see good, but not perfect agreement between the two curves. In fact, the majority of this discrepancy comes from off-resonant interaction with the first order sideband which the simulation captures but the analytical solution does not.</p>
<p>This can be confirmed by eliminating this off-resonant interaction in our simulation by setting they keyword argument <code class="docutils literal notranslate"><span class="pre">lamb_dicke_order</span></code> in the <code class="docutils literal notranslate"><span class="pre">hamiltonian</span></code> function to zero (by default, this is set to 1).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">h</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">lamb_dicke_order</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c"># set lamb_dicke_order here</span>
<span class="nd">@time</span> <span class="n">tout</span><span class="p">,</span> <span class="n">sol</span> <span class="o">=</span> <span class="n">timeevolution</span><span class="o">.</span><span class="n">schroedinger_dynamic</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">ψi</span><span class="p">,</span> <span class="n">h</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.619270 seconds (824.26 k allocations: 347.098 MiB)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">ex</span> <span class="o">=</span> <span class="n">expect</span><span class="p">(</span><span class="n">ionprojector</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">),</span> <span class="n">sol</span><span class="p">)</span>
<span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;numerical&quot;</span><span class="p">)</span>
<span class="n">η</span> <span class="o">=</span> <span class="n">get_η</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tout</span><span class="p">,</span> <span class="n">analytical</span><span class="o">.</span><span class="n">rabi_flop</span><span class="p">(</span><span class="n">tout</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">η</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;analytical&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tout</span><span class="p">[</span><span class="k">end</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Excitation&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;Time [μs]&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/getting_started_62_0.png" src="../_images/getting_started_62_0.png" />
</div>
</div>
<p>Which givesa a much better agreement between the two curves.</p>
<p>At this point, it’s worth explaining in more detail what we’ve just done. Conventionally, we would probably guess that setting the <code class="docutils literal notranslate"><span class="pre">lamb_dicke_order</span></code> to <code class="docutils literal notranslate"><span class="pre">n</span></code> would be equivalent to truncating the Taylor series expansion of the displacement operator <span class="math notranslate nohighlight">\(D(iη e^{iνt})\)</span> after the <span class="math notranslate nohighlight">\(n^{th}\)</span> order in η.</p>
<p>But this is not what IonSim does. Instead, it just drops all (Fock basis) matrix elements of <span class="math notranslate nohighlight">\(\langle m | D | n \rangle\)</span> where <span class="math notranslate nohighlight">\(|m-n| &gt; n\)</span>.</p>
<p>All matrix elements of the operator are computed <a class="reference external" href="https://doi.org/10.1103/PhysRev.177.1857">analytically</a>. So, for example, even if we set <code class="docutils literal notranslate"><span class="pre">lamb_dicke_order=0</span></code>, we’ll still retain the precise effect that the mode coupling has on the carrier transition – as in the above example.</p>
</div>
<div class="section" id="sideband-transitions">
<h3>Sideband Transitions<a class="headerlink" href="#sideband-transitions" title="Permalink to this headline">¶</a></h3>
<p>Let’s see some examples of driving sideband transitions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">tspan</span> <span class="o">=</span> <span class="mi">0</span><span class="o">:</span><span class="mf">0.1</span><span class="o">:</span><span class="mi">100</span>
<span class="n">mode</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c"># set the motional dimension back to 10</span>

<span class="n">L</span><span class="o">.</span><span class="n">Δ</span>  <span class="o">=</span> <span class="n">Δf</span> <span class="o">+</span> <span class="n">mode</span><span class="o">.</span><span class="n">ν</span>  <span class="c"># tune laser frequency to blue sideband</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="nd">@time</span> <span class="n">tout</span><span class="p">,</span> <span class="n">sol_blue</span> <span class="o">=</span> <span class="n">timeevolution</span><span class="o">.</span><span class="n">schroedinger_dynamic</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">ionstate</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;S-1/2&quot;</span><span class="p">)</span> <span class="n">⊗</span> <span class="n">fockstate</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">h</span><span class="p">)</span>

<span class="n">L</span><span class="o">.</span><span class="n">Δ</span>  <span class="o">=</span> <span class="n">Δf</span> <span class="o">-</span> <span class="n">mode</span><span class="o">.</span><span class="n">ν</span>  <span class="c"># tune laser frequency to red sideband</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="nd">@time</span> <span class="n">tout</span><span class="p">,</span> <span class="n">sol_red</span> <span class="o">=</span> <span class="n">timeevolution</span><span class="o">.</span><span class="n">schroedinger_dynamic</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">ionstate</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;S-1/2&quot;</span><span class="p">)</span> <span class="n">⊗</span> <span class="n">fockstate</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">h</span><span class="p">)</span>

<span class="n">ex_blue</span> <span class="o">=</span> <span class="n">expect</span><span class="p">(</span><span class="n">ionprojector</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">),</span> <span class="n">sol_blue</span><span class="p">)</span>
<span class="n">ex_red</span> <span class="o">=</span> <span class="n">expect</span><span class="p">(</span><span class="n">ionprojector</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">),</span> <span class="n">sol_red</span><span class="p">)</span>
<span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">ex_blue</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;blue sideband&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">ex_red</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;red sideband&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tout</span><span class="p">[</span><span class="k">end</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Excitation&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;Time [μs]&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.052846 seconds (1.30 M allocations: 40.075 MiB)
</pre></div>
</div>
<img alt="../_images/getting_started_66_1.png" src="../_images/getting_started_66_1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.052249 seconds (1.41 M allocations: 43.428 MiB)
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p>The fast oscillations come from off-resonant excitation of the carrier transition. The slower oscillations are from population being driven back and forth between <span class="math notranslate nohighlight">\(|S_{-1/2}, n=0\rangle \leftrightarrow |D_{-1/2}, n=1 \rangle\)</span>. We only see these when detuning blue, because we start with the vibrational mode in the ground state (<code class="docutils literal notranslate"><span class="pre">fockstate(mode.basis,</span> <span class="pre">0)</span></code>).</p>
<p>If we instead start out in <code class="docutils literal notranslate"><span class="pre">fockstate(mode.basis,</span> <span class="pre">1)</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="o">.</span><span class="n">Δ</span>  <span class="o">=</span> <span class="n">Δf</span> <span class="o">+</span> <span class="n">mode</span><span class="o">.</span><span class="n">ν</span>  <span class="c"># tune laser frequency to blue sideband</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="nd">@time</span> <span class="n">tout</span><span class="p">,</span> <span class="n">sol_blue</span> <span class="o">=</span> <span class="n">timeevolution</span><span class="o">.</span><span class="n">schroedinger_dynamic</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">ionstate</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;S-1/2&quot;</span><span class="p">)</span> <span class="n">⊗</span> <span class="n">fockstate</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">h</span><span class="p">)</span>

<span class="n">L</span><span class="o">.</span><span class="n">Δ</span>  <span class="o">=</span> <span class="n">Δf</span> <span class="o">-</span> <span class="n">mode</span><span class="o">.</span><span class="n">ν</span>  <span class="c"># tune laser frequency to red sideband</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">rwa_cutoff</span><span class="o">=</span><span class="mf">1e7</span><span class="p">)</span>
<span class="nd">@time</span> <span class="n">tout</span><span class="p">,</span> <span class="n">sol_red</span> <span class="o">=</span> <span class="n">timeevolution</span><span class="o">.</span><span class="n">schroedinger_dynamic</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">ionstate</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;S-1/2&quot;</span><span class="p">)</span> <span class="n">⊗</span> <span class="n">fockstate</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">h</span><span class="p">)</span>

<span class="n">ex_blue</span> <span class="o">=</span> <span class="n">expect</span><span class="p">(</span><span class="n">ionprojector</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">),</span> <span class="n">sol_blue</span><span class="p">)</span>
<span class="n">ex_red</span> <span class="o">=</span> <span class="n">expect</span><span class="p">(</span><span class="n">ionprojector</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">),</span> <span class="n">sol_red</span><span class="p">)</span>
<span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">ex_blue</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;blue sideband&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">ex_red</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;red sideband&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tout</span><span class="p">[</span><span class="k">end</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Excitation&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;Time [μs]&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.053634 seconds (1.50 M allocations: 46.197 MiB)
</pre></div>
</div>
<img alt="../_images/getting_started_68_1.png" src="../_images/getting_started_68_1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.064181 seconds (1.46 M allocations: 44.905 MiB)
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p>The large detuning is coming almost entirely from an AC Stark shift off of the carrier transition.</p>
<p>We can confirm this by using they <code class="docutils literal notranslate"><span class="pre">rwa_cutoff</span></code> keyword in the <code class="docutils literal notranslate"><span class="pre">hamiltonian</span></code> function. Setting <code class="docutils literal notranslate"><span class="pre">rwa_cutoff=x</span></code>, will neglect all terms in the Hamiltonian that oscillate faster than <code class="docutils literal notranslate"><span class="pre">x</span></code>. <em>(Note: this doesn’t apply to user-defined time-dependent parameters, which will be described in the next section).</em></p>
<p>Since the vibrational mode frequency has been set to 1 MHz, if we set <code class="docutils literal notranslate"><span class="pre">rwa_cutoff=1e5</span></code>, we should neglect the carrier Stark shift in our simulation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="o">.</span><span class="n">Δ</span>  <span class="o">=</span> <span class="n">Δf</span> <span class="o">+</span> <span class="n">mode</span><span class="o">.</span><span class="n">ν</span>  <span class="c"># tune laser frequency to blue sideband</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">rwa_cutoff</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span> <span class="c"># set rwa_cutoff here</span>
<span class="nd">@time</span> <span class="n">tout</span><span class="p">,</span> <span class="n">sol_blue</span> <span class="o">=</span> <span class="n">timeevolution</span><span class="o">.</span><span class="n">schroedinger_dynamic</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">ionstate</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;S-1/2&quot;</span><span class="p">)</span> <span class="n">⊗</span> <span class="n">fockstate</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">h</span><span class="p">)</span>

<span class="n">L</span><span class="o">.</span><span class="n">Δ</span>  <span class="o">=</span> <span class="n">Δf</span> <span class="o">-</span> <span class="n">mode</span><span class="o">.</span><span class="n">ν</span>  <span class="c"># tune laser frequency to red sideband</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">rwa_cutoff</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span> <span class="c"># set rwa_cutoff here</span>
<span class="nd">@time</span> <span class="n">tout</span><span class="p">,</span> <span class="n">sol_red</span> <span class="o">=</span> <span class="n">timeevolution</span><span class="o">.</span><span class="n">schroedinger_dynamic</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">ionstate</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;S-1/2&quot;</span><span class="p">)</span> <span class="n">⊗</span> <span class="n">fockstate</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">h</span><span class="p">)</span>

<span class="n">ex_blue</span> <span class="o">=</span> <span class="n">expect</span><span class="p">(</span><span class="n">ionprojector</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">),</span> <span class="n">sol_blue</span><span class="p">)</span>
<span class="n">ex_red</span> <span class="o">=</span> <span class="n">expect</span><span class="p">(</span><span class="n">ionprojector</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">),</span> <span class="n">sol_red</span><span class="p">)</span>
<span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">ex_blue</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;blue sideband&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">ex_red</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;red sideband&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tout</span><span class="p">[</span><span class="k">end</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Excitation&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;Time [μs]&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/getting_started_70_0.png" src="../_images/getting_started_70_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.001210 seconds (18.77 k allocations: 1.035 MiB)
  0.001284 seconds (14.93 k allocations: 939.938 KiB)
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p>A final note about the <code class="docutils literal notranslate"><span class="pre">rwa_cutoff</span></code>:
If <code class="docutils literal notranslate"><span class="pre">hamiltonian</span></code> knows that you’re not performing an RWA, it can do some optimization to reduce the number of internal functions that need to be evaluated, leading to faster performance. We can let it know that we’re not performing an RWA by setting <code class="docutils literal notranslate"><span class="pre">rwa_cutoff=Inf</span></code> (this is the default value).</p>
<p>To reiterate: if you’re not performing an RWA, then setting <code class="docutils literal notranslate"><span class="pre">rwa_cutoff</span></code> equal to <code class="docutils literal notranslate"><span class="pre">Inf</span></code>, rather than some arbitrarily large value, will lead to faster performance.</p>
</div>
<hr class="docutils" />
<div class="section" id="time-dependent-parameters">
<h3>Time-dependent parameters<a class="headerlink" href="#time-dependent-parameters" title="Permalink to this headline">¶</a></h3>
<p>All of the parameters denoted as time-dependent in the Hamiltonian equation at the start of this notebook can be set to arbitrary single-valued functions by the user. This can be useful for things like optimal control and modeling noise.</p>
<p>Below we’ll give a couple of examples of this.</p>
<hr class="docutils" />
<p>First we note that the Stark shift-induced detuning of the BSB Rabi flop in the previous section can be compensated by adding an additional detuning to the laser:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="o">.</span><span class="n">Δ</span>  <span class="o">=</span> <span class="n">Δf</span> <span class="o">+</span> <span class="n">mode</span><span class="o">.</span><span class="n">ν</span> <span class="o">-</span> <span class="mf">31e3</span>  <span class="c"># add additional detuning to BSB to compensate for carrier Stark shift</span>

<span class="n">tspan</span> <span class="o">=</span> <span class="mi">0</span><span class="o">:</span><span class="mf">0.1</span><span class="o">:</span><span class="mi">60</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="nd">@time</span> <span class="n">tout</span><span class="p">,</span> <span class="n">sol</span> <span class="o">=</span> <span class="n">timeevolution</span><span class="o">.</span><span class="n">schroedinger_dynamic</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">ionstate</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;S-1/2&quot;</span><span class="p">)</span> <span class="n">⊗</span> <span class="n">fockstate</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">h</span><span class="p">)</span>


<span class="n">ex</span> <span class="o">=</span> <span class="n">expect</span><span class="p">(</span><span class="n">ionprojector</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">),</span> <span class="n">sol</span><span class="p">)</span>
<span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tout</span><span class="p">[</span><span class="k">end</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Excitation&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;Time [μs]&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/getting_started_76_0.png" src="../_images/getting_started_76_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.036950 seconds (851.66 k allocations: 26.287 MiB)
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p>However, we’re still stuck with the off-resonant population oscillations from the carrier transition. It turns out we can eliminate these by ramping up the amplitude of the laser at the beginning of the simulation.</p>
<p>Such a ramp can be set with the <code class="docutils literal notranslate"><span class="pre">:E</span></code> field of the laser:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">E</span> <span class="o">=</span> <span class="n">Efield_from_pi_time</span><span class="p">(</span><span class="mf">2e-6</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;S-1/2&quot;</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">))</span>  <span class="c"># get previous value of electric field strength</span>

<span class="c"># Simple amplitude ramping function</span>
<span class="k">function</span> <span class="n">Ω</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">4</span>
        <span class="k">return</span> <span class="n">E</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="nb">π</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="mi">16</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span>
    <span class="k">end</span>
    <span class="n">E</span>
<span class="k">end</span><span class="p">;</span>

<span class="n">L</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">Ω</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span>L.Δ  = Δf + mode.ν - 31e3  # add additional detuning to BSB to compensate for carrier Stark shift

tspan = 0:0.1:60
h = hamiltonian(T)
@time tout, sol = timeevolution.schroedinger_dynamic(tspan, ionstate(T, &quot;S-1/2&quot;) ⊗ fockstate(mode, 0), h)


ex = expect(ionprojector(T, &quot;D-1/2&quot;), sol)
step = 1
plt.plot(tout[1:step:end], ex[1:step:end])
plt.plot(tout, @.(Ω(tout) / 2E), linestyle=&quot;--&quot;, label=&quot;scaled ramp&quot;)
plt.xlim(tout[1], tout[end])
plt.ylim(0, 1)
plt.legend(loc=1)
plt.ylabel(&quot;Excitation&quot;)
plt.xlabel(&quot;Time [μs]&quot;);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/getting_started_79_0.png" src="../_images/getting_started_79_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.064904 seconds (1.28 M allocations: 36.053 MiB)
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p>To be a bit more succinct we can use a Julia <em>anonymous function</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># To make things interesting let&#39;s also reduce the ramp time from 4 μs to 1 μs</span>
<span class="n">L</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">?</span>  <span class="n">E</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="nb">π</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span> <span class="o">:</span> <span class="n">E</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span>L.Δ  = Δf + mode.ν - 31e3  # add additional detuning to BSB to compensate for carrier Stark shift

tspan = 0:0.1:60
h = hamiltonian(T)
@time tout, sol = timeevolution.schroedinger_dynamic(tspan, ionstate(T, &quot;S-1/2&quot;) ⊗ fockstate(mode, 0), h)


ex = expect(ionprojector(T, &quot;D-1/2&quot;), sol)
step = 1
plt.plot(tout[1:step:end], ex[1:step:end])
plt.plot(tout, @.(Ω(tout) / 2E), linestyle=&quot;--&quot;, label=&quot;scaled ramp&quot;)
plt.xlim(tout[1], tout[end])
plt.legend(loc=1)
plt.ylim(0, 1)
plt.ylabel(&quot;Excitation&quot;)
plt.xlabel(&quot;Time [μs]&quot;);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/getting_started_82_0.png" src="../_images/getting_started_82_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.061311 seconds (1.29 M allocations: 36.205 MiB)
</pre></div>
</div>
</div>
</div>
<p>Even with just a 1 μs ramp, we already see noticeable reduction of the fast oscillations.</p>
<hr class="docutils" />
<p>As an example, of a time-dependent laser frequency we can simulate Rapid Adiabatic Passage or <a class="reference external" href="https://doi.org/10.1080/09500340600741082">RAP</a>, which can be used for robust preparation of the ion in an excited state.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># We&#39;ll linearly sweep through the laser&#39;s frequency from -150 kHz to +150 kHz detuned from the carrier transition</span>
<span class="c"># in a time Tp</span>

<span class="n">Tp</span> <span class="o">=</span> <span class="mi">150</span> <span class="c"># the length of time of the frequency chirp in μs</span>
<span class="n">Δϕ</span> <span class="o">=</span> <span class="mi">2</span><span class="nb">π</span> <span class="o">*</span> <span class="mf">150e-3</span>  <span class="c"># this is equal to half the detuning range we will chirp the laser over multiplied by the timescale (1e-6)</span>
<span class="n">L</span><span class="o">.</span><span class="n">ϕ</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="o">-</span><span class="n">Δϕ</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="n">Δϕ</span> <span class="o">/</span> <span class="n">Tp</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span>

<span class="c"># We&#39;ll also ramp the Rabi frequency. Note I wasn&#39;t able to match the results from the paper when using a Gaussian profile, as they</span>
<span class="c"># as described in the referenced paper</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">Efield_from_pi_time</span><span class="p">(</span><span class="mf">6.5e-6</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;S-1/2&quot;</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">))</span>
<span class="n">tr</span> <span class="o">=</span> <span class="mi">33</span>
<span class="k">function</span> <span class="n">Ω</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">tr</span>
        <span class="k">return</span> <span class="n">E</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="nb">π</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="mi">4</span><span class="n">tr</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span>
    <span class="k">elseif</span> <span class="n">tr</span> <span class="o">&lt;=</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="mi">150</span> <span class="o">-</span> <span class="n">tr</span>
        <span class="k">return</span> <span class="n">E</span>
    <span class="k">elseif</span> <span class="mi">150</span> <span class="o">-</span> <span class="n">tr</span> <span class="o">&lt;</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">150</span>
        <span class="k">return</span> <span class="n">E</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="nb">π</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="mi">150</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="n">tr</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span>
    <span class="k">else</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="n">L</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">Ω</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span>T.B = 2.9e-4  # Set the B-field to match the value in the reference
Δf = transition_frequency(T, 1, (&quot;S-1/2&quot;, &quot;D-1/2&quot;))

L.Δ  = Δf  # set detuning back to carrier 

tspan = 0:0.1:175
h = hamiltonian(T)
@time tout, sol = timeevolution.schroedinger_dynamic(tspan, ionstate(T, &quot;S-1/2&quot;) ⊗ fockstate(mode, 0), h)


ex = expect(ionprojector(T, &quot;D-1/2&quot;), sol)
step = 1
plt.plot(tout[1:step:end], ex[1:step:end], lw=3)
plt.plot(tout, @.(L.E(tout) / 2E), linestyle=&quot;--&quot;, label=&quot;scaled amplitude profile&quot;)
plt.plot(tout, @.(L.ϕ(tout) / (2Δϕ * tout)), linestyle=&quot;--&quot;, label=&quot;scaled frequency profile&quot;)
plt.xlim(tout[1], tout[end])
plt.legend(loc=1)
plt.ylim(0, 1)
plt.ylabel(&quot;Excitation&quot;)
plt.xlabel(&quot;Time [μs]&quot;);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/getting_started_86_0.png" src="../_images/getting_started_86_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.125243 seconds (3.43 M allocations: 75.402 MiB, 18.93% gc time)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span>detuning_range = 2π*1e-6 .* collect(1e3:2e4:2e6)
pops = Vector{Float64}(undef, 0)
for Δϕ in detuning_range
    L.ϕ = t -&gt; (-Δϕ/2 + (Δϕ / Tp) * t) * t
    h = hamiltonian(T)
    _, sol = timeevolution.schroedinger_dynamic(tspan, ionstate(T, &quot;S-1/2&quot;) ⊗ fockstate(mode, 0), h)
    push!(pops, real(expect(ionprojector(T, &quot;D-1/2&quot;), sol)[end]))
end
plt.plot(@.(detuning_range * 1e3), pops, lw=3, color=&quot;C1&quot;)
plt.xlim(-10, detuning_range[end] * 1e3)
plt.ylim(0, 1.01)
plt.ylabel(&quot;Final Excited State\nPopulation&quot;)
plt.xlabel(&quot;detuning range [kHz]&quot;);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/getting_started_87_0.png" src="../_images/getting_started_87_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="o">.</span><span class="n">ϕ</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c"># get rid of frequency chirp</span>
<span class="n">Δf</span> <span class="o">=</span> <span class="n">transition_frequency</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;S-1/2&quot;</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">))</span>  <span class="c"># and recompute the transition frequency</span>
<span class="n">L</span><span class="o">.</span><span class="n">Δ</span> <span class="o">=</span> <span class="n">Δf</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="noise">
<h3>Noise<a class="headerlink" href="#noise" title="Permalink to this headline">¶</a></h3>
<p>QuantumOptics has several solvers that can incorporate noise. Here are some examples for using these with IonSim. For more see the examples section.</p>
<hr class="docutils" />
<p>First we’ll consider decoherence of the state <span class="math notranslate nohighlight">\(|\psi\rangle = |S\rangle + |D\rangle\)</span> due to B-field fluctuations, which can be implemented by setting <code class="docutils literal notranslate"><span class="pre">T.δB</span></code> which has units of Tesla (we won’t do it here, but this value can also be made time-dependent).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">StochasticDiffEq</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">tspan</span> <span class="o">=</span> <span class="n">collect</span><span class="p">(</span><span class="mi">0</span><span class="o">:</span><span class="mf">10.</span><span class="o">:</span><span class="mi">30000</span><span class="p">)</span>
<span class="n">β</span> <span class="o">=</span> <span class="mf">1e-2</span>
<span class="n">σ</span> <span class="o">=</span> <span class="o">√</span><span class="p">(</span><span class="mi">2</span><span class="n">β</span><span class="p">)</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">StochasticDiffEq</span><span class="o">.</span><span class="n">OrnsteinUhlenbeckProcess</span><span class="p">(</span><span class="n">β</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">σ</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="n">w</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;O-U noise&quot;</span><span class="p">)</span>
<span class="n">warray</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span><span class="p">(</span><span class="n">t</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="kp">in</span> <span class="n">tspan</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">warray</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/getting_started_94_0.png" src="../_images/getting_started_94_0.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1-element Array{PyCall.PyObject,1}:
 PyObject &lt;matplotlib.lines.Line2D object at 0x7f9f805248d0&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">DSP</span><span class="o">:</span> <span class="n">periodogram</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">sample_rate</span> <span class="o">=</span> <span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tspan</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">tspan</span><span class="p">[</span><span class="k">end</span><span class="p">]</span>
<span class="n">pwarray</span> <span class="o">=</span> <span class="n">periodogram</span><span class="p">(</span><span class="n">warray</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">sample_rate</span><span class="p">)</span>
<span class="n">freqs</span> <span class="o">=</span> <span class="n">pwarray</span><span class="o">.</span><span class="n">freq</span>
<span class="n">abs_freqs</span> <span class="o">=</span> <span class="n">freqs</span> <span class="o">.*</span> <span class="mf">1e6</span>
<span class="n">powers</span> <span class="o">=</span> <span class="n">pwarray</span><span class="o">.</span><span class="n">power</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">50</span>
<span class="k">for</span> <span class="n">i</span> <span class="kp">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">StochasticDiffEq</span><span class="o">.</span><span class="n">OrnsteinUhlenbeckProcess</span><span class="p">(</span><span class="n">β</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">σ</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">w</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">warray</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span><span class="p">(</span><span class="n">t</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="kp">in</span> <span class="n">tspan</span><span class="p">]</span>
    <span class="n">powers</span> <span class="o">.+=</span> <span class="n">periodogram</span><span class="p">(</span><span class="n">warray</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">sample_rate</span><span class="p">)</span><span class="o">.</span><span class="n">power</span>
<span class="k">end</span>
<span class="n">powers</span> <span class="o">./=</span> <span class="n">powers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">abs_freqs</span><span class="p">,</span> <span class="n">powers</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;numerical&quot;</span><span class="p">)</span>
<span class="n">ou_psd</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">=</span> <span class="n">σ</span><span class="o">^</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">β</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="nb">π</span> <span class="o">*</span> <span class="n">f</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">abs_freqs</span><span class="p">,</span> <span class="n">ou_psd</span><span class="o">.</span><span class="p">(</span><span class="n">freqs</span><span class="p">)</span> <span class="o">./</span> <span class="n">ou_psd</span><span class="p">(</span><span class="n">freqs</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;C1&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;theoretical&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&quot;--&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;relative power&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;frequency [Hz]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;O-U PSD&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">10e-3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="mf">2e4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/getting_started_96_0.png" src="../_images/getting_started_96_0.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PyObject &lt;matplotlib.legend.Legend object at 0x7fa0433ab550&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">mode</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c"># we&#39;re not paying attention to the vibrational mode here, so we set its dimension to 1</span>

<span class="c"># construct a zero operator</span>
<span class="n">L</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">T</span><span class="o">.</span><span class="n">δB</span> <span class="o">=</span> <span class="mf">5e-8</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>

<span class="c"># let&#39;s work with a Δm=2 transition</span>
<span class="n">T</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">ions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">selected_level_structure</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;S-1/2&quot;</span><span class="p">,</span> <span class="s">&quot;D-5/2&quot;</span><span class="p">]</span>

<span class="c"># construct noise operator</span>
<span class="n">T</span><span class="o">.</span><span class="n">δB</span> <span class="o">=</span> <span class="mf">5e-7</span>
<span class="n">hs</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="n">hsvec</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">ψ</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">hs</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ψ</span><span class="p">)]</span>

<span class="n">ψi_ion</span> <span class="o">=</span> <span class="p">(</span><span class="n">ionstate</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;S-1/2&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">ionstate</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;D-5/2&quot;</span><span class="p">))</span><span class="o">/√</span><span class="mi">2</span>
<span class="n">ψi_mode</span> <span class="o">=</span> <span class="n">fockstate</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">ψi</span> <span class="o">=</span> <span class="n">ψi_ion</span> <span class="n">⊗</span> <span class="n">ψi_mode</span>

<span class="n">Ntraj</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">ex</span> <span class="o">=</span> <span class="n">zero</span><span class="p">(</span><span class="n">tspan</span><span class="p">)</span>

<span class="c"># iterate SDE solver Ntraj times and avergage results</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">StochasticDiffEq</span><span class="o">.</span><span class="n">OrnsteinUhlenbeckProcess</span><span class="p">(</span><span class="n">β</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">σ</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="kp">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">Ntraj</span>
    <span class="n">tout</span><span class="p">,</span> <span class="n">sol</span> <span class="o">=</span> <span class="n">stochastic</span><span class="o">.</span><span class="n">schroedinger_dynamic</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">ψi</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">hsvec</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="n">w</span><span class="p">,</span>
    <span class="n">normalize_state</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">ex</span> <span class="o">.+=</span> <span class="n">real</span><span class="o">.</span><span class="p">(</span><span class="n">expect</span><span class="p">(</span><span class="n">dm</span><span class="p">(</span><span class="n">ψi_ion</span><span class="p">)</span> <span class="n">⊗</span> <span class="n">one</span><span class="p">(</span><span class="n">mode</span><span class="p">),</span> <span class="n">sol</span><span class="p">))</span> <span class="o">./</span> <span class="n">Ntraj</span>
<span class="k">end</span>

<span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tspan</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;C0&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;Simulated Contrast&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">tspan</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tspan</span><span class="p">[</span><span class="k">end</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Ramsey Signal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;Time [μs]&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/getting_started_97_0.png" src="../_images/getting_started_97_0.png" />
</div>
</div>
<p>We can compare the same magnitude of B-field fluctuations for a white PSD. We could use the stochastic solver again, but instead let’s use a Lindblad master equation solver:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">γ1</span> <span class="o">=</span> <span class="n">hs</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">40</span>
<span class="n">γ2</span> <span class="o">=</span> <span class="n">hs</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mi">40</span>

<span class="n">rates</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="nb">π</span> <span class="o">.*</span> <span class="n">abs</span><span class="o">.</span><span class="p">([</span><span class="n">γ1</span><span class="p">,</span> <span class="n">γ2</span><span class="p">])</span>

<span class="n">hs1</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="s">&quot;S-1/2&quot;</span><span class="p">]</span> <span class="n">⊗</span> <span class="n">C</span><span class="p">[</span><span class="s">&quot;S-1/2&quot;</span><span class="p">]</span><span class="o">&#39;</span> <span class="n">⊗</span> <span class="n">one</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
<span class="n">hs2</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="s">&quot;D-5/2&quot;</span><span class="p">]</span> <span class="n">⊗</span> <span class="n">C</span><span class="p">[</span><span class="s">&quot;D-5/2&quot;</span><span class="p">]</span><span class="o">&#39;</span> <span class="n">⊗</span> <span class="n">one</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>

<span class="n">tspan</span> <span class="o">=</span> <span class="n">collect</span><span class="p">(</span><span class="mi">0</span><span class="o">:</span><span class="mf">1.</span><span class="o">:</span><span class="mi">15000</span><span class="p">)</span>
<span class="nd">@time</span> <span class="n">tout</span><span class="p">,</span> <span class="n">sol</span> <span class="o">=</span> <span class="n">timeevolution</span><span class="o">.</span><span class="n">master</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">dm</span><span class="p">(</span><span class="n">ψi</span><span class="p">),</span> <span class="n">h</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">[</span><span class="n">hs1</span><span class="p">,</span> <span class="n">hs2</span><span class="p">],</span> <span class="n">rates</span><span class="o">=</span><span class="n">rates</span><span class="p">)</span>

<span class="n">ex</span> <span class="o">=</span> <span class="n">expect</span><span class="p">(</span><span class="n">dm</span><span class="p">(</span><span class="n">ψi_ion</span><span class="p">)</span> <span class="n">⊗</span> <span class="n">one</span><span class="p">(</span><span class="n">mode</span><span class="p">),</span> <span class="n">sol</span><span class="p">)</span>
<span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tspan</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">step</span><span class="o">:</span><span class="k">end</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">tspan</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tspan</span><span class="p">[</span><span class="k">end</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Ramsey Contrast&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;Time [μs]&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/getting_started_99_0.png" src="../_images/getting_started_99_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  3.361256 seconds (11.86 M allocations: 573.513 MiB, 4.51% gc time)
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p>A brute force way to include shot-to-shot noise on a simulated parameter is to just run the simulation multiple times – with the parameter pulled each time from some probability distribution – and then average the results.</p>
<p>As an example, we consider fluctuations of the laser’s electric field <span class="math notranslate nohighlight">\(E\)</span> such that  <span class="math notranslate nohighlight">\(E \sim \mathcal{N}(\bar{E}, \delta E^2)\)</span>, then we should expect a Gaussian decay profile <span class="math notranslate nohighlight">\(e^{-t^2 / 2\tau^2}\)</span> with: <span class="math notranslate nohighlight">\(1/\tau = \delta E\bigg(\frac{\partial\omega}{\partial E}\bigg)\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span>Δf = transition_frequency(T, 1, (&quot;S-1/2&quot;, &quot;D-1/2&quot;))  #recompute the transition frequency
L.Δ = Δf

T.configuration.ions[1].selected_level_structure = [&quot;S-1/2&quot;, &quot;D-1/2&quot;]
T.B = 4e-4
T.δB = 0
E = Efield_from_pi_time(2e-6, T, 1, 1, (&quot;S-1/2&quot;, &quot;D-1/2&quot;))
L.Δ = Δf
tspan = 0:0.1:60

# average over Ntraj runs
Ntraj = 500
δE = 0.025E
ex = zero(tspan)
ψi = ionstate(T, &quot;S-1/2&quot;) ⊗ fockstate(mode, 0)
@time begin
    for i in 1:Ntraj
        ΔE = δE * randn()
        L.E = E + ΔE 
        h = hamiltonian(T)
        tout, sol = timeevolution.schroedinger_dynamic(tspan, ψi, h)
        ex .+= expect(ionprojector(T, &quot;D-1/2&quot;), sol) ./ Ntraj
    end
end

# compute expected τ
hz_per_E = 1 / Efield_from_rabi_frequency(1, ẑ, L, C, (&quot;S-1/2&quot;, &quot;D-1/2&quot;))
τ_us = 1e6 / (2π * δE * hz_per_E)

step = 1
plt.plot(tspan[1:step:end], ex[1:step:end])
plt.plot(tspan, @.((1 + exp(-(tspan / (√2 * τ_us))^2))/2), color=&quot;C1&quot;, ls=&quot;--&quot;, label=&quot;Gaussian Envelope&quot;)
plt.plot(tspan, @.((1 - exp(-(tspan / (√2 * τ_us))^2))/2), color=&quot;C1&quot;, ls=&quot;--&quot;)
plt.xlim(tspan[1], tspan[end])
plt.ylim(0, 1)
plt.legend()
plt.ylabel(&quot;Excitation&quot;)
plt.xlabel(&quot;Time [μs]&quot;);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/getting_started_101_0.png" src="../_images/getting_started_101_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  1.696484 seconds (48.59 M allocations: 1.540 GiB, 11.89% gc time)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="adding-more-than-a-single-ion-laser">
<h3>Adding more than a single ion/ laser<a class="headerlink" href="#adding-more-than-a-single-ion-laser" title="Permalink to this headline">¶</a></h3>
<p>Adding addtional lasers and ions to the system is straightforward. Here we’ll see how that’s done by modelling a <a class="reference external" href="https://doi.org/10.1103/PhysRevA.62.022311">Molmer-Sorensen interaction</a>, which can be used to entangle the electronic states of multiple ions and requires at least two laser tones and vibrational mode.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># Construct the system</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">Ca40</span><span class="p">([</span><span class="s">&quot;S-1/2&quot;</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">])</span>
<span class="n">L1</span> <span class="o">=</span> <span class="n">Laser</span><span class="p">();</span> <span class="n">L2</span> <span class="o">=</span> <span class="n">Laser</span><span class="p">()</span> 
<span class="n">chain</span> <span class="o">=</span> <span class="n">LinearChain</span><span class="p">(</span><span class="n">ions</span><span class="o">=</span><span class="p">[</span><span class="n">C</span><span class="p">,</span> <span class="n">C</span><span class="p">],</span> <span class="n">com_frequencies</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">3e6</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mf">3e6</span><span class="p">,</span><span class="n">z</span><span class="o">=</span><span class="mf">1e6</span><span class="p">),</span> <span class="n">vibrational_modes</span><span class="o">=</span><span class="p">(;</span><span class="n">z</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">Trap</span><span class="p">(</span><span class="n">configuration</span><span class="o">=</span><span class="n">chain</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mf">4e-4</span><span class="p">,</span> <span class="n">Bhat</span><span class="o">=</span><span class="p">(</span><span class="n">x̂</span> <span class="o">+</span> <span class="n">ẑ</span><span class="p">)</span><span class="o">/√</span><span class="mi">2</span><span class="p">,</span> <span class="n">lasers</span><span class="o">=</span><span class="p">[</span><span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># Set the laser parameters</span>
<span class="n">ϵ</span> <span class="o">=</span> <span class="mf">40e3</span>
<span class="n">d</span> <span class="o">=</span> <span class="mi">80</span>  <span class="c"># corrects for AC stark shift from single-photon coupling to sidebands</span>
<span class="n">mode</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">vibrational_modes</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">Δf</span> <span class="o">=</span> <span class="n">transition_frequency</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;S-1/2&quot;</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">))</span>
<span class="n">L1</span><span class="o">.</span><span class="n">Δ</span> <span class="o">=</span> <span class="n">Δf</span> <span class="o">+</span> <span class="n">mode</span><span class="o">.</span><span class="n">ν</span> <span class="o">+</span> <span class="n">ϵ</span> <span class="o">-</span> <span class="n">d</span>
<span class="n">L1</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">ẑ</span>
<span class="n">L1</span><span class="o">.</span><span class="n">ϵ</span> <span class="o">=</span> <span class="n">x̂</span>

<span class="n">L2</span><span class="o">.</span><span class="n">Δ</span> <span class="o">=</span> <span class="n">Δf</span> <span class="o">-</span> <span class="n">mode</span><span class="o">.</span><span class="n">ν</span> <span class="o">-</span> <span class="n">ϵ</span> <span class="o">+</span> <span class="n">d</span>
<span class="n">L2</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">ẑ</span>
<span class="n">L2</span><span class="o">.</span><span class="n">ϵ</span> <span class="o">=</span> <span class="n">x̂</span>

<span class="n">mode</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">η</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">get_η</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">L1</span><span class="p">,</span> <span class="n">C</span><span class="p">))</span>
<span class="n">Ω1</span> <span class="o">=</span> <span class="o">√</span><span class="p">(</span><span class="mf">1e3</span> <span class="o">*</span> <span class="n">ϵ</span><span class="p">)</span> <span class="o">/</span> <span class="n">η</span>  <span class="c"># This will give a 1kHz MS strength, since coupling goes like (ηΩ)^2/ϵ</span>

<span class="n">Efield_from_rabi_frequency!</span><span class="p">(</span><span class="n">Ω1</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;S-1/2&quot;</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">))</span>
<span class="n">Efield_from_rabi_frequency!</span><span class="p">(</span><span class="n">Ω1</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;S-1/2&quot;</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">));</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">ψi</span> <span class="o">=</span> <span class="n">ionstate</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;S-1/2&quot;</span><span class="p">,</span> <span class="s">&quot;S-1/2&quot;</span><span class="p">)</span> <span class="n">⊗</span> <span class="n">fockstate</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>  <span class="c"># initial state</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># setup and run the Hamiltonian</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">rwa_cutoff</span><span class="o">=</span><span class="mf">5e5</span><span class="p">)</span>
<span class="n">tspan</span> <span class="o">=</span> <span class="mi">0</span><span class="o">:</span><span class="mf">0.25</span><span class="o">:</span><span class="mi">1000</span>
<span class="nd">@time</span> <span class="n">tout</span><span class="p">,</span> <span class="n">sol</span> <span class="o">=</span> <span class="n">timeevolution</span><span class="o">.</span><span class="n">schroedinger_dynamic</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">ψi</span><span class="p">,</span> <span class="n">h</span><span class="p">);</span>

<span class="n">SS</span> <span class="o">=</span> <span class="n">expect</span><span class="p">(</span><span class="n">ionprojector</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;S-1/2&quot;</span><span class="p">,</span> <span class="s">&quot;S-1/2&quot;</span><span class="p">),</span> <span class="n">sol</span><span class="p">)</span>
<span class="n">DD</span> <span class="o">=</span> <span class="n">expect</span><span class="p">(</span><span class="n">ionprojector</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">),</span> <span class="n">sol</span><span class="p">)</span>
<span class="n">SD</span> <span class="o">=</span> <span class="n">expect</span><span class="p">(</span><span class="n">ionprojector</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;S-1/2&quot;</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">),</span> <span class="n">sol</span><span class="p">)</span>
<span class="n">DS</span> <span class="o">=</span> <span class="n">expect</span><span class="p">(</span><span class="n">ionprojector</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">,</span> <span class="s">&quot;S-1/2&quot;</span><span class="p">),</span> <span class="n">sol</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">SS</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;SS&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">DD</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;DD&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">SD</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;SD&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">DS</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;DS&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tout</span><span class="p">[</span><span class="k">end</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;Time [μs]&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/getting_started_107_0.png" src="../_images/getting_started_107_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.025516 seconds (684.52 k allocations: 22.892 MiB)
</pre></div>
</div>
</div>
</div>
<p>We can compare this to the analytical result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="o">?</span><span class="n">analytical</span><span class="o">.</span><span class="n">two_ion_ms</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="highlight- notranslate"><div class="highlight"><pre><span></span>two_ion_ms(tspan, Ω::Real, ν::Real, δ::Real, η::Real, n̄::Real)
</pre></div>
</div>
<p><a class="reference external" href="https://doi.org/10.1103/PhysRevA.62.022311">ref</a> <br> Assumes vibrational mode starts in a thermal state with: $\langle a^\dagger a\rangle = n̄$  and ions start in doubly ground state. Returns <code class="docutils literal notranslate"><span class="pre">(ρgg,</span> <span class="pre">ρee)</span></code>, the population in the doubly  ground and doubly excited state, respectively. $[Ω], [ν], [δ] = Hz$</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">ex</span> <span class="o">=</span> <span class="n">analytical</span><span class="o">.</span><span class="n">two_ion_ms</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="mf">1e-6</span><span class="n">Ω1</span><span class="p">,</span> <span class="mf">1e-6</span><span class="n">mode</span><span class="o">.</span><span class="n">ν</span><span class="p">,</span> <span class="mf">1e-6</span><span class="n">mode</span><span class="o">.</span><span class="n">ν</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="n">ϵ</span><span class="p">,</span> <span class="n">η</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">SS</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">DD</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s">&quot;--&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s">&quot;--&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/getting_started_110_0.png" src="../_images/getting_started_110_0.png" />
</div>
</div>
<p>We can also see what happens when the vibrational mode starts out in a thermal state:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">mode</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">ρi</span> <span class="o">=</span> <span class="n">dm</span><span class="p">(</span><span class="n">ionstate</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;S-1/2&quot;</span><span class="p">,</span> <span class="s">&quot;S-1/2&quot;</span><span class="p">))</span> <span class="n">⊗</span> <span class="n">thermalstate</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c"># thermal state</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">rwa_cutoff</span><span class="o">=</span><span class="mf">5e5</span><span class="p">)</span>
<span class="n">tspan</span> <span class="o">=</span> <span class="n">collect</span><span class="p">(</span><span class="mi">0</span><span class="o">:</span><span class="mf">0.25</span><span class="o">:</span><span class="mi">1000</span><span class="p">)</span>
<span class="nd">@time</span> <span class="n">tout</span><span class="p">,</span> <span class="n">sol</span> <span class="o">=</span> <span class="n">timeevolution</span><span class="o">.</span><span class="n">schroedinger_dynamic</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">ρi</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

<span class="n">SS</span> <span class="o">=</span> <span class="n">expect</span><span class="p">(</span><span class="n">ionprojector</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;S-1/2&quot;</span><span class="p">,</span> <span class="s">&quot;S-1/2&quot;</span><span class="p">),</span> <span class="n">sol</span><span class="p">)</span>
<span class="n">DD</span> <span class="o">=</span> <span class="n">expect</span><span class="p">(</span><span class="n">ionprojector</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">),</span> <span class="n">sol</span><span class="p">)</span>
<span class="n">SD</span> <span class="o">=</span> <span class="n">expect</span><span class="p">(</span><span class="n">ionprojector</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;S-1/2&quot;</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">),</span> <span class="n">sol</span><span class="p">)</span>
<span class="n">DS</span> <span class="o">=</span> <span class="n">expect</span><span class="p">(</span><span class="n">ionprojector</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">,</span> <span class="s">&quot;S-1/2&quot;</span><span class="p">),</span> <span class="n">sol</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">SS</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;SS&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">DD</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;DD&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">SD</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;SD&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">DS</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;DS&quot;</span><span class="p">)</span>
<span class="n">ex</span> <span class="o">=</span> <span class="n">analytical</span><span class="o">.</span><span class="n">two_ion_ms</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="mf">1e-6</span><span class="n">Ω1</span><span class="p">,</span> <span class="mf">1e-6</span><span class="n">mode</span><span class="o">.</span><span class="n">ν</span><span class="p">,</span> <span class="mf">1e-6</span><span class="n">mode</span><span class="o">.</span><span class="n">ν</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="n">ϵ</span><span class="p">,</span> <span class="n">η</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s">&quot;--&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">ex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s">&quot;--&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tout</span><span class="p">[</span><span class="k">end</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;Time [μs]&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/getting_started_112_0.png" src="../_images/getting_started_112_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.710937 seconds (2.42 M allocations: 325.332 MiB, 26.27% gc time)
</pre></div>
</div>
</div>
</div>
<p>There is some discrepancy because of the Lamb-Dicke approximation made in the analytical solution.</p>
<p>Adding more ions/lasers/modes is done the same way.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">chain</span> <span class="o">=</span> <span class="n">LinearChain</span><span class="p">(</span><span class="n">ions</span><span class="o">=</span><span class="p">[</span><span class="n">C</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">C</span><span class="p">],</span> <span class="n">com_frequencies</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">3e6</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mf">3e6</span><span class="p">,</span><span class="n">z</span><span class="o">=</span><span class="mf">1e6</span><span class="p">),</span> <span class="n">vibrational_modes</span><span class="o">=</span><span class="p">(;</span><span class="n">z</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">Trap</span><span class="p">(</span><span class="n">configuration</span><span class="o">=</span><span class="n">chain</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mf">4e-4</span><span class="p">,</span> <span class="n">Bhat</span><span class="o">=</span><span class="p">(</span><span class="n">x̂</span> <span class="o">+</span> <span class="n">ẑ</span><span class="p">)</span><span class="o">/√</span><span class="mi">2</span><span class="p">,</span> <span class="n">lasers</span><span class="o">=</span><span class="p">[</span><span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="p">])</span>
<span class="n">global_beam!</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">L1</span><span class="p">)</span>  <span class="c"># set L1 to shine equally on all ions</span>
<span class="n">global_beam!</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">L2</span><span class="p">)</span>  <span class="c"># set L2 to shine equally on all ions</span>
<span class="n">mode</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">vibrational_modes</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">mode</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">η</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">get_η</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">L1</span><span class="p">,</span> <span class="n">C</span><span class="p">))</span>
<span class="n">Ω2</span> <span class="o">=</span> <span class="o">√</span><span class="p">(</span><span class="mf">1e3</span> <span class="o">*</span> <span class="n">ϵ</span><span class="p">)</span> <span class="o">/</span> <span class="n">η</span>  
<span class="n">Efield_from_rabi_frequency!</span><span class="p">(</span><span class="n">Ω2</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;S-1/2&quot;</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">))</span>
<span class="n">Efield_from_rabi_frequency!</span><span class="p">(</span><span class="n">Ω2</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;S-1/2&quot;</span><span class="p">,</span> <span class="s">&quot;D-1/2&quot;</span><span class="p">))</span>
<span class="n">ψi</span> <span class="o">=</span> <span class="n">ionstate</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">repeat</span><span class="p">([</span><span class="s">&quot;S-1/2&quot;</span><span class="p">],</span> <span class="mi">6</span><span class="p">)</span><span class="o">...</span><span class="p">)</span> <span class="n">⊗</span> <span class="n">fockstate</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">rwa_cutoff</span><span class="o">=</span><span class="mf">5e5</span><span class="p">)</span>
<span class="n">tspan</span> <span class="o">=</span> <span class="mi">0</span><span class="o">:</span><span class="mf">0.25</span><span class="o">:</span><span class="mi">2000</span>
<span class="nd">@time</span> <span class="n">tout</span><span class="p">,</span> <span class="n">sol</span> <span class="o">=</span> <span class="n">timeevolution</span><span class="o">.</span><span class="n">schroedinger_dynamic</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">ψi</span><span class="p">,</span> <span class="n">h</span><span class="p">);</span>

<span class="n">S</span> <span class="o">=</span> <span class="n">expect</span><span class="p">(</span><span class="n">ionprojector</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">repeat</span><span class="p">([</span><span class="s">&quot;S-1/2&quot;</span><span class="p">],</span> <span class="mi">6</span><span class="p">)</span><span class="o">...</span><span class="p">),</span> <span class="n">sol</span><span class="p">)</span>
<span class="n">D</span> <span class="o">=</span> <span class="n">expect</span><span class="p">(</span><span class="n">ionprojector</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">repeat</span><span class="p">([</span><span class="s">&quot;D-1/2&quot;</span><span class="p">],</span> <span class="mi">6</span><span class="p">)</span><span class="o">...</span><span class="p">),</span> <span class="n">sol</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">S</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;SSSSSS&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;DDDDDD&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">tout</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tout</span><span class="p">[</span><span class="k">end</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;6 Ion Molmer Sorensen&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;Time [μs]&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/getting_started_115_1.png" src="../_images/getting_started_115_1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  1.316544 seconds (7.52 M allocations: 277.820 MiB, 14.34% gc time)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="ionsim-physicalconstants">
<h3>IonSim.PhysicalConstants<a class="headerlink" href="#ionsim-physicalconstants" title="Permalink to this headline">¶</a></h3>
<p>You can find some commonly used physical constants in <code class="docutils literal notranslate"><span class="pre">IonSim.PhysicalConstants</span></code>. They support all normal algebraic operations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="n">pc</span> <span class="o">=</span> <span class="n">IonSim</span><span class="o">.</span><span class="n">PhysicalConstants</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">pc</span><span class="o">.</span><span class="n">ħ</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0545718e-34 [m²kg/s]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">pc</span><span class="o">.</span><span class="n">c</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.99792458e8 [m/s]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">print</span><span class="p">(</span><span class="n">pc</span><span class="o">.</span><span class="n">μB</span> <span class="o">/</span> <span class="n">pc</span><span class="o">.</span><span class="n">ħ</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
<span class="n">print</span><span class="p">(</span><span class="n">pc</span><span class="o">.</span><span class="n">ħ</span> <span class="o">+</span> <span class="n">pc</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
<span class="n">print</span><span class="p">(</span><span class="n">pc</span><span class="o">.</span><span class="n">α</span><span class="o">^</span><span class="n">pc</span><span class="o">.</span><span class="n">α</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8.794100069810324e10
2.99792458e8
0.9647321772836126
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "HaeffnerLab/IonSim.jl-Examples",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "julia-1.4"
        },
        kernelOptions: {
            kernelName: "julia-1.4",
            path: "./not-included"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'julia-1.4'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>